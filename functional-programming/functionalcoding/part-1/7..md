# 7. 신뢰할 수 없는 코드를 쓰면서 불변성 지키기

레거시 코드나 신뢰할 수 없는 코드로부터 나의 함수형 코드를 지키기위해선

<mark style="background-color:green;">'방어적 복사'</mark>를 합니다.



'카피-온-라이트'는 얕은복사

'방어적 복사'는 깊은 복사



깊은 복사는 안전하지만 비효율적이다.

상식적으로.



loadash의 [cloneDeep](https://lodash.com/docs/4.17.15#cloneDeep)을 사용해야한다.

js에 깊은 복사는 없다.

json함수 사용은 문제가 있음.



### 추가 팁

* 웹 API속에서 방어적 복사

JSON 데이터가 API에 요청으로 들어왔다고 할때, 직렬화하는 과정에서 JSON.parse, 등이 '깊은 복사'를 하고 그래서 오래걸린다.



* 함수에서 어려개의 데이터 객체들을 가지고 있어도 되는지 이들은 데이터일 뿐 이걸 우리는 처리하고 기록할 뿐이다.



*
